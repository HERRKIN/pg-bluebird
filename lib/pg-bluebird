"use strict";

var bluebird = require("bluebird");

var PgBlueBird = function (pg, pgConfig) {
    this.pg = pg;
    this.pgConfig = pgConfig;
};

PgBlueBird.prototype.connect = function () {

    var deferred = bluebird.pending();

    this.pg.connect(this.pgConfig, function (error, client, done) {

        if (error) {

            deferred.reject(error);
        } else {

            client.queryP = q.nbind(client.query, client);

            deferred.fulfill({client: client, done: done});
        }
    });

    return deferred.promise;
};

module.exports = PgBlueBird;